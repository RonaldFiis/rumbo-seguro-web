<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Cuenta - Rumbo Seguro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        #campo-especialidad { display: none; }
        .checkbox-group {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--light);
            border-radius: 0.5rem;
            padding: 0.75rem;
            background: #fafafa;
        }
        .checkbox-group label {
            display: flex; align-items: center; padding: 0.5rem;
            border-radius: 0.25rem; cursor: pointer; font-weight: 500;
        }
        .checkbox-group label:hover { background-color: #f0f5ff; }
        .checkbox-group input {
            margin-right: 0.75rem; width: auto;
            accent-color: var(--primary); transform: scale(1.1);
        }
    </style>
</head>
<body class="auth-wrapper">

    <div class="auth-card">
        <div class="text-center" style="margin-bottom: 2rem;">
            <a href="index.html" class="nav-logo" style="justify-content: center; margin-bottom: 1.5rem;">
                <img src="images/logo.svg" alt="Rumbo Seguro Logo">
                <span>RUMBO SEGURO</span>
            </a>
            <h2 style="color: var(--dark); font-weight: 700;">Crea tu cuenta</h2>
            <p style="color: var(--gray);">Es gratis y solo toma un minuto.</p>
        </div>

        <div id="msg-error" style="display: none; background: #ffebee; color: #c62828; padding: 10px; border-radius: 0.5rem; margin-bottom: 1rem; text-align: center;"></div>
        <div id="msg-success" style="display: none; background: #e8f5e9; color: #2e7d32; padding: 10px; border-radius: 0.5rem; margin-bottom: 1rem; text-align: center;"></div>

        <form id="registro-form">
            <div style="margin-bottom: 1rem;">
                <label for="nombres" class="form-label">Nombre Completo</label>
                <input type="text" id="nombres" class="form-input" required placeholder="Ej. Juan P√©rez">
            </div>
            <div style="margin-bottom: 1rem;">
                <label for="email" class="form-label">Correo Institucional</label>
                <input type="email" id="email" class="form-input" required placeholder="ejemplo@uni.edu.pe">
            </div>
            <div style="margin-bottom: 1rem;">
                <label for="password" class="form-label">Contrase√±a</label>
                <input type="password" id="password" class="form-input" required placeholder="M√≠nimo 6 caracteres">
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label for="rol" class="form-label">Soy:</label>
                <select id="rol" class="form-input" style="background: white;">
                    <option value="estudiante">üéì Estudiante</option>
                    <option value="tutor">üë®‚Äçüè´ Docente Tutor</option>
                    <option value="psicologo">üß† Psic√≥logo(a)</option>
                </select>
            </div>
            
            <div id="campo-especialidad" style="margin-bottom: 1.5rem;">
                <label for="especialidad" class="form-label">¬øEn qu√© cursos puedes ser tutor?</label>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="curso" value="C√°lculo Diferencial"> C√°lculo Diferencial</label>
                    <label><input type="checkbox" name="curso" value="C√°lculo Integral"> C√°lculo Integral</label>
                    <label><input type="checkbox" name="curso" value="C√°lculo Multivariable"> C√°lculo Multivariable</label>
                    <label><input type="checkbox" name="curso" value="√Ålgebra Lineal"> √Ålgebra Lineal</label>
                    <label><input type="checkbox" name="curso" value="Geometr√≠a Anal√≠tica"> Geometr√≠a Anal√≠tica</label>
                    <label><input type="checkbox" name="curso" value="Ecuaciones Diferenciales"> Ecuaciones Diferenciales</label>
                    <label><input type="checkbox" name="curso" value="C√°lculo Num√©rico"> C√°lculo Num√©rico</label>
                    <label><input type="checkbox" name="curso" value="F√≠sica I"> F√≠sica I</label>
                    <label><input type="checkbox" name="curso" value="F√≠sica II"> F√≠sica II</label>
                    <label><input type="checkbox" name="curso" value="Qu√≠mica I"> Qu√≠mica I</label>
                    <label><input type="checkbox" name="curso" value="Qu√≠mica 2"> Qu√≠mica 2</label>
                    <label><input type="checkbox" name="curso" value="Dibujo de Ingenier√≠a"> Dibujo de Ingenier√≠a</label>
                    <label><input type="checkbox" name="curso" value="Introducci√≥n a la Computaci√≥n"> Introducci√≥n a la Computaci√≥n</label>
                    <label><input type="checkbox" name="curso" value="Algoritmia y Estructura de Datos"> Algoritmia y Estructura de Datos</label>
                    <label><input type="checkbox" name="curso" value="Programaci√≥n Orientada a Objetos"> Programaci√≥n Orientada a Objetos</label>
                    <label><input type="checkbox" name="curso" value="Matem√°tica Discreta"> Matem√°tica Discreta</label>
                    <label><input type="checkbox" name="curso" value="Estad√≠stica Aplicada"> Estad√≠stica Aplicada</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 1rem;">
                <i class="fas fa-user-plus"></i> Registrarme
            </button>
        </form>

        <p class="text-center" style="margin-top: 1.5rem; color: var(--gray);">
            ¬øYa tienes cuenta? <a href="login.html" style="color: var(--primary); font-weight: 600;">Inicia sesi√≥n</a>
        </p>
    </div>

    <script>
        const rolSelect = document.getElementById('rol');
        const campoEspecialidad = document.getElementById('campo-especialidad');

        rolSelect.addEventListener('change', () => {
            if (rolSelect.value === 'tutor') {
                campoEspecialidad.style.display = 'block';
            } else {
                campoEspecialidad.style.display = 'none';
            }
        });

        document.getElementById('registro-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const errorDiv = document.getElementById('msg-error');
            const successDiv = document.getElementById('msg-success');
            errorDiv.style.display = 'none'; successDiv.style.display = 'none';

            const rol = document.getElementById('rol').value;
            let especialidadesSeleccionadas = [];
            if (rol === 'tutor') {
                const checkboxes = document.querySelectorAll('#campo-especialidad input[name="curso"]:checked');
                checkboxes.forEach((checkbox) => {
                    especialidadesSeleccionadas.push(checkbox.value);
                });
            }
            const especialidadString = especialidadesSeleccionadas.join(', ');

            const datos = {
                nombres: document.getElementById('nombres').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                rol: rol,
                es_tutor: rol === 'tutor',
                especialidad: rol === 'tutor' ? especialidadString : null
            };

            try {
                const res = await fetch('/api/registro', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                const data = await res.json();
                if (res.ok) {
                    successDiv.textContent = '¬°Cuenta creada! Redirigiendo al login...';
                    successDiv.style.display = 'block';
                    setTimeout(() => window.location.href = 'login.html', 2000);
                } else {
                    errorDiv.textContent = data.error || 'Error al registrar';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'No se pudo conectar al servidor.';
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>
</html>
